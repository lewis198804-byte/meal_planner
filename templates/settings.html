<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>PlatePlanner</title>

    <!--Animation CSS effects-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!--Bootstrap styles-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!--Custom CSS changes-->
    <!--<link rel="stylesheet" href="{{ url_for('static', filename='css/custom_styling.css') }}" />-->
    <!--JS that gets laoded once the site has been rendered.-->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  </head>

  <body>
    <section>
        <header >
          <nav class="navbar navbar-expand-lg bg-body-tertiary mb-2">
            <div class="container-fluid">
              <a class="navbar-brand" href="/"><strong>PlatePlanner</strong></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/recipes">Recipes</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/add_recipe">Manual Add</a>
                  </li>
                  <li class="nav-item" >
                    <a class="nav-link" href="/ai_recipe_add">AI Add</a>
                  </li>
                  <li class="nav-item" >
                    <a class="nav-link" href="/shopping_list">Shopping List</a>
                  </li>
                  <li class="nav-item" >
                    <a class="nav-link active" href="/settings">Settings</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        </header>
            <div class=" text-center mt-5 mx-auto" style="width:40em">
                <h1>Settings</h1>
            </div>
        </header>
    </section>
    <section>
        <div class="container ">
          <div class="row">
            <div class="alert p-3 text-center" id="saveOutcome">
              <!--insert save outcome here via JS-->
            </div>
          </div>
          <div class="row   mt-5">
            <div class="col col-12 col-md-6 text-end">
              <div class=" p-3">
                Enter your Open AI API key to utilise the AI recipe generation feature.
              </div>
            </div>
            <div class="col col-12 col-md-6">
              <div class="p-1 text-end">
                <form >
                  <div class="form-floating">
                    <input type="text" id="apiTextInput" disabled class="form-control bg-success-subtle" placeholder="Open AI Api Key">
                    <label for="api_key" class="form-label">Open AI Api Key</label>
                      <div class="form-text" id="apiConfigText">
                        <!--input api status here-->
                      </div>

                  </div>

                
              </div>
            </div>
            <div class="col col-12 col-md-6 text-end">
              <div class=" p-3">
                How often would you like to create local backups?
              </div>
            </div>
            <div class="col col-12 col-md-6">
              <div class="p-3 text-start">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
                  <label class="form-check-label" for="inlineRadio1">1</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
                  <label class="form-check-label" for="inlineRadio2">2</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3" >
                  <label class="form-check-label" for="inlineRadio3">3</label>
                </div>
              </div>
            </div>
            <div class="col col-12 text-center">
              <button class="btn btn-primary" id="saveButton" onclick="saveSettings()">Save</button>
            </div>
          </form>
    </section>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
      const apiKeyField = document.getElementById("apiTextInput");
      const saveButton = document.getElementById("saveButton");
      const saveOutcomeAlert = document.getElementById("saveOutcome");
      const apiStatusText = document.getElementById("apiConfigText")
      saveOutcomeAlert.hidden = true;
      populateSettings()


      
      async function populateSettings(){
        const response = await fetch("/get_settings");
        const res = await response.json();

        if (res.ok == "true"){
          if (res['apiKey'] != ""){
            apiStatusText.innerText = "Success! API key configured in .env file"
            apiKeyField.value = res['apiKey'];

          }

        }
        else{
          console.log("there was an error loading settings")
        }
      }



      async function saveSettings(){
        event.preventDefault()
        freshApiKey = apiKeyField.value

        if (freshApiKey != ""){
          formstuff = new FormData()

          const updateKey = await fetch("/update_settings", {method:'POST', body:formstuff});
          const updateRes = await updateKey.json();
          let outcome = ""
          if (updateRes.ok == "true"){
            console.log("settings has been updated");
            outcome = updateRes.ok;
          }
          else if (updateRes.ok == "false"){
            console.log("did not update because of an error");
            outcome = updateRes.ok;
          }
          saveOutcomeAlert.innerText = outcome;
          saveOutcomeAlert.hidden = false;
        }

      }



    </script>
  </body>
</html>