<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PlatePlanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  </head>
  <body>
    <section>
         <header >
          <nav class="navbar navbar-expand-lg bg-body-tertiary mb-5">
            <div class="container-fluid">
              <a class="navbar-brand" href="#"><strong>PlatePlanner</strong></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link "  href="/">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link " href="/recipes">Recipes</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/add_recipe">Manual Add</a>
                  </li>
                  <li class="nav-item" >
                    <a class="nav-link"  href="/ai_recipe_add">AI Add</a>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Dev Tools
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="/database_build">Rebuild DB</a></li>
                      <li><a class="dropdown-item" href="#">Another action</a></li>
                      <li><a class="dropdown-item" href="#">Something else here</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        </header>
    </section>
    <section>
        
        <div class="container">
            
            <div class="row justify-content-md-center ">

                <div class="col col-12 col-md-6 ">
                    <div class="card mt-5">
                        <div class="accordion" id="accordionExample">
                            <!-- FIRST ITEM -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                <button class="accordion-button " type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#collapseOne" 
                                        aria-expanded="true" aria-controls="collapseOne">
                                    Main details
                                </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <strong>These are the main recipe details</strong> <br>
                                    <small>These fields are required to save the recipe!</small>
                                    <form id="recipe_details">
                                    <div class="mb-3 mt-3 mx-auto text-center" >
                                        <label class="form-label" for="recipe_name">Recipe Name</label>
                                        <input type="text" class="form-control w-100" name="recipe_name" id="recipe_name">
                                    </div>
                                    <div class="mb-3 mx-auto text-center">
                                        <label class="form-label" for="instructions">Instructions</label>
                                        <textarea class="form-control w-100" style="height:10em; width:20em" 
                                                name="instructions" id="instructions" aria-describedby="instructions-help"></textarea>
                                        <div id="instructions-help" class="form-text">instructions from the recipe</div>
                                    </div>
                                    <div class="mb-3 mx-auto text-center">
                                        <label class="form-label" for="ingredients">Ingredients</label>
                                        <textarea class="form-control w-100" style="height:10em;" 
                                                name="ingredients" id="ingredients" aria-describedby="ingredients-help"></textarea>
                                        <div id="ingredients-help" class="form-text">Ingredients detected from supplied recipe image.</div>
                                    </div>
                                    </form> <!-- FORM 1 CLOSED -->
                                </div> <!-- ACCORDION-BODY 1 CLOSED -->
                                </div> <!-- COLLAPSE 1 CLOSED -->
                            </div> <!-- ITEM 1 CLOSED -->

                            <!-- SECOND ITEM -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#collapseTwo" 
                                        aria-expanded="false" aria-controls="collapseTwo">
                                    Additional Details
                                </button>
                                </h2>
                                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <strong>Add additional details that aren't required but are helpful! </strong> 
                                    <form id="additional_details"> <!-- UNIQUE FORM ID -->
                                    <div class="mb-3 mt-3 mx-auto text-center" >
                                        <label class="form-label" for="recipe_location">Recipe Location</label>
                                        <input type="text" class="form-control w-100" name="where" id="recipe_location">
                                    </div>
                                    <div class="mb-3 mx-auto text-center" >
                                        <label class="form-label" for="page_number">Page Number?</label>
                                        <input type="text" class="form-control w-100" name="page_number" id="page_number">
                                    </div>
                                    <div class="mb-3 mx-auto text-center" >
                                        <label for="difficulty_range" class="form-label">Difficulty</label>
                                        <input type="range" class="form-range w-100" step="1" min="0" max="2" value="0" id="difficulty_range">
                                        <output for="difficulty_range" id="rangeValue"></output>
                                    </div>
                                    <div class="mb-3 mx-auto text-center" >
                                        <label class="form-label" for="recipe_photo">Photo</label>
                                        <input type="file" class="form-control w-100" name="recipe_photo" id="recipe_photo">
                                    </div>
                                    </form> <!-- FORM 2 CLOSED -->
                                </div> <!-- ACCORDION-BODY 2 CLOSED -->
                                </div> <!-- COLLAPSE 2 CLOSED -->
                            </div> <!-- ITEM 2 CLOSED -->
                            </div> <!-- ACCORDION CLOSED -->

                        
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col col-12">
                    <div class=" text-center mt-3">
                        <div class="spinner-border text-info" id="spinner" role="status">
                                <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="alert alert-danger invisible" role="alert" id="error_field"> test error</div>
                        <p><button class="btn btn-primary mt-5" onclick='save_recipe()'>Save Recipe</button></p>
                    </div>
                </div>
            </div>
        </div>
        
    </section>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>

        const error_field = document.getElementById("error_field");
        const name_field = document.getElementById("recipe_name");
        const recipe_location = document.getElementById("recipe_location");
        
        const page_number = document.getElementById("page_number");
        const instructions = document.getElementById("instructions");
        const ingredients = document.getElementById("ingredients");
        
        const recipe_photo = document.getElementById("recipe_photo");



        const rangeInput = document.getElementById('difficulty_range');
        const rangeOutput = document.getElementById('rangeValue');

        const spinner_div = document.getElementById('spinner');
       


        spinner_div.hidden = true;
        // Set initial value
        rangeOutput.textContent = "Easy";
        let difficulty_text = "Easy"
        rangeInput.addEventListener('input', function() {
            if (this.value == 0){
                difficulty_text = "Easy"
            }
            if (this.value == 1){
                difficulty_text = "Medium"
            }
            if (this.value == 2){
                difficulty_text = "Hard"
            }
            rangeOutput.textContent = difficulty_text;
        });


        

        async function save_recipe(){
            toggleAlert("off")
            const response = await fetch("/save_ai_recipe", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({'recipe_name': name_field.value, 'location': recipe_location.value, 'page_number': page_number.value, 'instructions': instructions.value, 'ingredients': ingredients.value, 'difficulty': difficulty_text,'recipe_photo': recipe_photo.value })
            })

            const insert_response = await response.json();
            if (insert_response.ok){
               
                
                console.log("recipe saved successfully")
            }
            else {
                console.log("error thing")
                console.log(insert_response.error)
                error_field.innerHTML =insert_response.error
                toggleAlert("on")
            }
        }

        function toggleAlert(state){
                if (state == "on"){
                error_field.classList.remove("invisible")
                error_field.classList.add("visible")
            }
            else {
                error_field.classList.remove("visible")
                error_field.classList.add("invisible")
            }
        }
    </script>

    </body>
</html>